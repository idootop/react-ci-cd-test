name: 'Build & Deploy React App to Github Pages'

on: 
  push:
    branches:
      - main 

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps: 
      # ç¬¬ä¸€æ­¥ æ‹‰ä»£ç 
      - name: Checkout âš¡ï¸
        uses: actions/checkout@v2
      
      # ç¬¬äºŒæ­¥ ç¼“å­˜node modules
      - name: Cache node modules ğŸš®
        uses: actions/cache@v2
        with:
          path: node_modules
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.OS }}-build-${{ env.cache-name }}-
            ${{ runner.OS }}-build-
            ${{ runner.OS }}-

      # ç¬¬ä¸‰æ­¥ å®‰è£…ä¾èµ–æ‰“åŒ…
      - name: Install and Build ğŸ”§  
        run: |
          npm install -g pnpm
          pnpm install
          pnpm run build
          cp dist/index.html dist/404.html
        shell: bash

      # ç¬¬å››æ­¥ å°†æ‰“åŒ…åçš„æ–‡ä»¶æ¨é€è‡³ä¸‹é¢å¡«å†™çš„åˆ†æ”¯ï¼Œéƒ¨ç½²åˆ°githubçš„é™æ€é¡µ
      - name: Deploy ğŸš€ 
        id: 'deploy'
        uses: JamesIves/github-pages-deploy-action@releases/v3
        with:
          GITHUB_TOKEN: ${{ secrets.WORKFLOW_TOKEN }}
          BRANCH: static-page # ç¼–è¯‘æ–‡ä»¶åˆ†æ”¯
          FOLDER: dist # ç¼–è¯‘æ–‡ä»¶çš„æ–‡ä»¶å¤¹
      
      # ç¬¬äº”æ­¥ å‘é€é‚®ä»¶é€šçŸ¥
      # - name: Send Notification ğŸ“§ 
      #   uses: dawidd6/action-send-mail@master
      #   with:
      #     server_address: smtp.163.com 
      #     server_port: 465
      #     username: ${{ secrets.MAIL_USERNAME }}
      #     password: ${{ secrets.MAIL_PASSWORD }}
      #     subject: ã€ã€‘#é‚®ä»¶ä¸»é¢˜
      #     body: é‚®ä»¶å†…å®¹
      #     to: xxxx@xxx.com # æ”¶ä»¶é‚®ç®±
      #     from: GitHub Actions # å‘ä»¶äºº